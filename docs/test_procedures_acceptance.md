# 受け入れテスト手順書

本ドキュメントでは、オンライン対戦テトリスの**受け入れテスト**手順を定義します。受け入れテストは、プロジェクトの要件が満たされているかを確認するためのテストです。

---

## 目的

受け入れテストの目的は、以下の観点からシステムが要件を満たしていることを確認することです:

1. **機能要件**: すべての機能が仕様通りに動作すること
2. **非機能要件**: パフォーマンス、可用性、セキュリティが基準を満たすこと
3. **ユーザー体験**: 実際のユーザーが快適に使用できること

---

## テスト環境

### 本番環境または本番相当環境
- AWS 上にデプロイされたアプリケーション
- または、本番環境と同等の構成のステージング環境

### テスト実施者
- プロダクトオーナー
- QA エンジニア
- エンドユーザー代表

---

## Phase 0: 基盤修正・安定化の受け入れテスト

### AC-P0-001: MVP動作確認

#### 目的
基本的なゲームフローが正常に動作すること

#### 手順
1. 2人のプレイヤーでルームを作成
2. ゲームを開始
3. ゲーム終了まで完走

#### 合格基準
- ✅ ルーム作成から参加、ゲーム開始、終了まで一連の流れがエラーなく動作する
- ✅ ゲームオーバー判定が正常に動作する
- ✅ 勝者が正しく判定される

#### 定量評価
- **成功率**: 10回中10回成功 (100%)

---

### AC-P0-002: TetrisGameコンポーネント表示

#### 目的
フロントエンドの主要コンポーネントが正常に表示されること

#### 手順
1. ゲームを開始
2. TetrisGameコンポーネントの表示を確認

#### 合格基準
- ✅ ゲームボード (10x20) が表示される
- ✅ 現在のピースが表示される
- ✅ Next Piece が表示される
- ✅ スコア、ライン数が表示される

#### 定量評価
- **表示率**: 100% (すべての要素が表示される)

---

### AC-P0-003: エラーハンドリング

#### 目的
主要なエラーケースで適切なエラーメッセージが表示されること

#### 手順
1. 存在しないルームに参加を試みる
2. 未認証でルームを作成を試みる
3. サーバー停止中に接続を試みる

#### 合格基準
- ✅ ユーザーにわかりやすいエラーメッセージが表示される
- ✅ アプリケーションがクラッシュしない
- ✅ エラー後に正常な操作が可能

#### 定量評価
- **エラーメッセージ表示率**: 100%

---

## Phase 1: コア機能拡張の受け入れテスト

### AC-P1-001: レベルシステム

#### 目的
ライン消去数に応じてレベルが上昇し、落下速度が変化すること

#### 手順
1. ゲームを開始
2. 10ライン消去
3. レベル表示とブロック落下速度を確認

#### 合格基準
- ✅ 10ライン消去ごとにレベルが1上昇する
- ✅ レベル上昇に伴い落下速度が速くなる
- ✅ レベル表示が UI に表示される

#### 定量評価
- **レベル1からレベル10までの落下速度変化**: 最低50%高速化

---

### AC-P1-002: T-Spinボーナス

#### 目的
T-Spinを成功させるとボーナススコアが付与されること

#### 手順
1. ゲームを開始
2. T-Spinを実行
3. スコアボーナスを確認

#### 合格基準
- ✅ T-Spin成功時に通常より高いスコアが付与される
- ✅ T-Spin表示（エフェクトまたはメッセージ）が表示される

#### 定量評価
- **T-Spinボーナス**: 通常の1.5倍以上のスコア

---

### AC-P1-003: モバイル対応

#### 目的
スマートフォンでゲームがプレイ可能であること

#### 手順
1. スマートフォンでアプリにアクセス
2. タッチ操作でゲームをプレイ
3. ゲームを完走

#### 合格基準
- ✅ レスポンシブデザインが適用される
- ✅ タッチ操作用のボタンが表示される
- ✅ 画面サイズに応じてレイアウトが調整される
- ✅ プレイに支障がない

#### 定量評価
- **対応デバイス**: iPhone, Android スマートフォン
- **画面サイズ**: 320px以上で正常表示

---

### AC-P1-004: サウンドエフェクト

#### 目的
ゲーム中に適切なサウンドが再生されること

#### 手順
1. ゲームを開始（音量オン）
2. 各種操作を実行

#### 合格基準
- ✅ ブロック移動音が再生される
- ✅ ライン消去音が再生される
- ✅ ゲームオーバー音が再生される
- ✅ 音量調整が可能

#### 定量評価
- **サウンド実装率**: 主要アクション (移動、回転、ライン消去、ゲームオーバー) の100%

---

### AC-P1-005: ルームカスタマイズ

#### 目的
ルーム作成時に名前やパスワードを設定できること

#### 手順
1. ルーム作成画面を開く
2. ルーム名「テストルーム」を入力
3. パスワード「1234」を設定
4. ルームを作成

#### 合格基準
- ✅ ルーム名が設定される
- ✅ パスワード保護が有効になる
- ✅ パスワードなしでは参加できない
- ✅ 正しいパスワードで参加できる

#### 定量評価
- **カスタマイズオプション**: ルーム名、パスワード、最大人数が設定可能

---

## Phase 2: データ永続化・認証の受け入れテスト

### AC-P2-001: ユーザー登録・ログイン

#### 目的
ユーザーアカウントを作成し、ログインできること

#### 手順
1. サインアップページにアクセス
2. メールアドレスとパスワードを入力
3. アカウント作成
4. ログアウト
5. 再度ログイン

#### 合格基準
- ✅ アカウント作成が成功する
- ✅ ログインが成功する
- ✅ セッションが維持される
- ✅ ログアウトが正常に動作する

#### 定量評価
- **認証成功率**: 100%
- **セッション維持時間**: 最低24時間

---

### AC-P2-002: ゲーム結果の保存

#### 目的
ゲーム終了後に結果がデータベースに保存されること

#### 手順
1. ログインしてゲームをプレイ
2. ゲームを終了
3. プロフィールページでゲーム履歴を確認

#### 合格基準
- ✅ ゲーム結果がデータベースに保存される
- ✅ スコア、ライン数、勝敗が正しく記録される
- ✅ ゲーム履歴が閲覧可能

#### 定量評価
- **保存成功率**: 100%
- **データ整合性**: すべての項目が正確に保存される

---

### AC-P2-003: ランキングシステム

#### 目的
ランキングが正しく表示されること

#### 手順
1. 複数のユーザーでゲームをプレイ
2. ランキングページにアクセス
3. ランキングの表示を確認

#### 合格基準
- ✅ スコア順にランキングが表示される
- ✅ グローバルランキングが表示される
- ✅ 週間ランキングが表示される
- ✅ ランキングがリアルタイムで更新される

#### 定量評価
- **ランキング更新遅延**: 最大5分以内
- **表示件数**: トップ100まで表示

---

### AC-P2-004: ユーザー統計

#### 目的
個人の統計情報が正しく表示されること

#### 手順
1. ログインしてプロフィールページにアクセス
2. 統計情報を確認

#### 合格基準
- ✅ 総ゲーム数が表示される
- ✅ 勝利数・敗北数が表示される
- ✅ 平均スコアが表示される
- ✅ 最高スコアが表示される
- ✅ プレイ時間が表示される

#### 定量評価
- **統計精度**: 100% (すべての値が正確)

---

## Phase 3: テスト・品質保証の受け入れテスト

### AC-P3-001: テストカバレッジ

#### 目的
コードのテストカバレッジが目標値に到達していること

#### 手順
1. バックエンドのテストを実行
2. フロントエンドのテストを実行
3. カバレッジレポートを確認

#### 合格基準
- ✅ バックエンドのカバレッジが80%以上
- ✅ フロントエンドのカバレッジが70%以上
- ✅ クリティカルパスが100%カバーされている

#### 定量評価
- **バックエンドカバレッジ**: ≥80%
- **フロントエンドカバレッジ**: ≥70%

---

### AC-P3-002: パフォーマンステスト

#### 目的
システムがパフォーマンス要件を満たすこと

#### 手順
1. 負荷テストツールを使用
2. 100人同時接続
3. レスポンスタイムを測定

#### 合格基準
- ✅ ゲーム状態同期のレイテンシーが100ms以下
- ✅ API レスポンスタイムが500ms以下
- ✅ 100人同時接続でも安定動作

#### 定量評価
- **ゲーム状態同期レイテンシー**: ≤100ms
- **APIレスポンスタイム**: ≤500ms
- **同時接続数**: ≥100人

---

### AC-P3-003: セキュリティスキャン

#### 目的
セキュリティ脆弱性がないこと

#### 手順
1. OWASP ZAPなどのツールでスキャン
2. 脆弱性レポートを確認
3. 重大な脆弱性がないことを確認

#### 合格基準
- ✅ Critical/High レベルの脆弱性が0件
- ✅ XSS, SQLインジェクション対策が実装されている
- ✅ CSRF対策が実装されている
- ✅ セキュリティヘッダーが設定されている

#### 定量評価
- **Critical脆弱性**: 0件
- **High脆弱性**: 0件
- **Medium脆弱性**: ≤5件

---

## Phase 4: AWSデプロイの受け入れテスト

### AC-P4-001: インフラ構築

#### 目的
Terraformでインフラが再現可能であること

#### 手順
1. Terraformコードを実行
2. AWSリソースが作成されることを確認
3. インフラを削除
4. 再度作成

#### 合格基準
- ✅ `terraform apply` でエラーなくリソースが作成される
- ✅ すべての必要なリソース（ECS, DynamoDB, Redis等）が作成される
- ✅ `terraform destroy` で正常に削除される
- ✅ 再作成が可能

#### 定量評価
- **インフラ構築成功率**: 100%
- **構築時間**: 15分以内

---

### AC-P4-002: CI/CDパイプライン

#### 目的
コードプッシュから自動デプロイまでが動作すること

#### 手順
1. feature ブランチを作成
2. コードを修正してプッシュ
3. プルリクエストを作成
4. CI が自動実行されることを確認
5. main にマージ
6. 自動デプロイが実行されることを確認

#### 合格基準
- ✅ プルリクエスト作成時に CI が実行される
- ✅ リント、テストが自動実行される
- ✅ main マージ後に自動デプロイされる
- ✅ デプロイ失敗時にロールバックされる

#### 定量評価
- **CI成功率**: ≥95%
- **デプロイ時間**: ≤10分

---

### AC-P4-003: モニタリング・アラート

#### 目的
システム監視とアラートが正常に動作すること

#### 手順
1. CloudWatch ダッシュボードにアクセス
2. メトリクスが収集されていることを確認
3. 意図的にエラーを発生させる
4. アラートが通知されることを確認

#### 合格基準
- ✅ CPU, メモリ, ネットワークのメトリクスが収集される
- ✅ アプリケーションログが CloudWatch Logs に送信される
- ✅ エラー率が閾値を超えるとアラートが発火する
- ✅ Slack/Email にアラートが通知される

#### 定量評価
- **メトリクス収集率**: 100%
- **アラート通知遅延**: ≤5分

---

## Phase 5: 本番デプロイ・運用開始の受け入れテスト

### AC-P5-001: 本番環境での動作確認

#### 目的
本番環境でシステムが正常に動作すること

#### 手順
1. 本番URLにアクセス
2. E2Eテストケースを実行
3. すべての機能が動作することを確認

#### 合格基準
- ✅ すべてのE2Eテストケースが PASS
- ✅ SSL/TLS が正常に動作
- ✅ 独自ドメインでアクセス可能
- ✅ エラーログに Critical エラーがない

#### 定量評価
- **E2E成功率**: 100%
- **稼働率**: ≥99.9%

---

### AC-P5-002: 負荷テスト（本番環境）

#### 目的
本番環境で想定ユーザー数に耐えられること

#### 手順
1. JMeter または Locust で負荷テストを実行
2. 同時接続1000人をシミュレート
3. システムの安定性を確認

#### 合格基準
- ✅ 1000人同時接続でも安定動作
- ✅ レスポンスタイムが許容範囲内
- ✅ エラー率が1%未満
- ✅ Auto Scaling が正常に動作

#### 定量評価
- **同時接続数**: ≥1000人
- **エラー率**: ≤1%
- **平均レスポンスタイム**: ≤500ms

---

### AC-P5-003: コスト確認

#### 目的
運用コストが予算内に収まること

#### 手順
1. AWS Cost Explorer で1週間分のコストを確認
2. 月間コストを試算
3. 予算と比較

#### 合格基準
- ✅ 月間コストが予算内（目標: 数千円以内）
- ✅ 想定外のコストが発生していない
- ✅ コスト最適化の余地があれば対応

#### 定量評価
- **月間コスト**: ≤10,000円
- **ユーザーあたりコスト**: ≤10円

---

### AC-P5-004: ドキュメント整備

#### 目的
運用に必要なドキュメントが整備されていること

#### 手順
1. ドキュメントリストを確認
2. 各ドキュメントが最新であることを確認

#### 合格基準
- ✅ 運用マニュアルが存在する
- ✅ トラブルシューティングガイドが存在する
- ✅ APIドキュメントが存在する
- ✅ アーキテクチャ図が最新

#### 定量評価
- **ドキュメントカバー率**: 100% (必須ドキュメントすべて存在)

---

## 受け入れテスト実行記録テンプレート

### テスト実行日: YYYY-MM-DD
### テスト実施者: [名前]
### 対象フェーズ: Phase X

| テストケースID | 合格基準達成 | 定量評価 | 結果 | 備考 |
|---------------|------------|---------|------|------|
| AC-P0-001 | ✅/❌ | 成功率: X% | PASS/FAIL | |
| AC-P0-002 | ✅/❌ | 表示率: X% | PASS/FAIL | |
| AC-P1-001 | ✅/❌ | 落下速度変化: X% | PASS/FAIL | |
| ... | | | | |

### 総合判定
- ✅ **合格**: すべての合格基準を満たしている
- ❌ **不合格**: 一部の基準を満たしていない

### 次のアクション
- [不合格の場合、修正すべき項目をリストアップ]

---

## 受け入れ基準サマリー

各フェーズの受け入れ完了条件:

| Phase | 受け入れ完了条件 |
|-------|----------------|
| Phase 0 | AC-P0-001 〜 AC-P0-003 すべて PASS |
| Phase 1 | AC-P1-001 〜 AC-P1-005 すべて PASS |
| Phase 2 | AC-P2-001 〜 AC-P2-004 すべて PASS |
| Phase 3 | AC-P3-001 〜 AC-P3-003 すべて PASS |
| Phase 4 | AC-P4-001 〜 AC-P4-003 すべて PASS |
| Phase 5 | AC-P5-001 〜 AC-P5-004 すべて PASS |

**プロジェクト完成条件**: Phase 0 〜 Phase 5 のすべての受け入れテストが PASS

---

**最終更新**: 2025-12-02
